{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bakery Shop</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'store/css/style.css' %}">
</head>

<body>

<div class="page-wrapper">

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">üç∞ Bakery</a>
            <form method="GET"
                action="{% url 'products' %}"
                class="d-flex align-items-center me-3" id="searchForm">
                

                <!-- SEARCH -->
                <input id="searchInput"class="form-control me-2"
                    type="text"
                    name="q"
                    placeholder="Search bakery items..."
                    value="{{ query }}"
                    class="form-control me-2"
                    >

                
                <button class="btn btn-outline-warning" type="submit">
                    üîç
                </button>
            </form>

            <div>
                {% if user.is_authenticated %}
                    <span class="me-2">Hi, {{ user.username }}</span>
                    <a href="{% url 'order_history' %}" class="btn btn-outline-secondary me-2">
                        My Orders
                    </a>
                    <a href="{% url 'cart' %}" class="btn btn-outline-warning">
                        Cart ({{ request.session.cart|length|default:0 }})
                    </a>
                    <!-- LOGOUT -->
                    <a href="{% url 'logout' %}" class="btn btn-outline-danger">
                        Logout
                    </a>
                {% else %}
                    <a href="/login/" class="btn btn-outline-secondary me-2">Login</a>
                    <a href="/register/" class="btn btn-warning">Register</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- PAGE CONTENT -->
    <main class="content container mt-4">
        {% block content %}{% endblock %}
    </main>

    <!-- FOOTER -->
    <footer class="footer bg-dark text-white text-center p-3">
        ¬© 2026 Bakery Shop | Fresh & Delicious
    </footer>

</div>

<!-- ‚úÖ GLOBAL JAVASCRIPT -->
<script>
/* ‚úÖ For Add-to-Cart quantity buttons (home / product pages) */
function changeQty(productId, change) {
    let qtyInput = document.getElementById('qty-' + productId);
    let minusBtn = document.getElementById('minus-' + productId);

    let qty = parseInt(qtyInput.value);
    qty += change;

    if (qty < 1) qty = 1;

    qtyInput.value = qty;

    // ‚úÖ Disable minus button only when qty = 1
    minusBtn.disabled = (qty === 1);
}

/* ‚úÖ For AJAX cart page quantity update */
function updateQuantity(productId, action) {
    fetch("{% url 'update_cart_quantity' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: `product_id=${productId}&action=${action}`
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById(`qty-${productId}`).innerText = data.quantity;
        document.getElementById(`item-total-${productId}`).innerText = data.item_total;
        document.getElementById("grand-total").innerText = data.grand_total;
    });
}

const input = document.getElementById("searchInput");
const form = document.getElementById("searchForm");

input.addEventListener("input", function () {
    // ‚úÖ If input cleared ‚Üí reload once to show all products
    if (this.value.trim() === "") {
        window.location.href = form.action;
    }
});
</script>

</body>
</html>
